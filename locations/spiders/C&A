# -*- coding: utf-8 -*-
import scrapy


class CAndASpider(scrapy.Spider):
    name = 'c_and_a'
    allowed_domains = ['https://www.c-and-a.com']
    start_urls = ['https://www.c-and-a.com/uk/en/corporate/company/about-ca/stores/locations/']

    def parse_address(self, response):
        addresses = response.xpath('//div[@class="addressBox"]/p[@class="address"]/text()').extract()
        for num, address in enumerate(addresses):
            if num % 2 == 0:
                address_1 = address
            if (num+1) % 2 == 0:
                address_2 = address.strip()
                address = address_1 + ' ' + address_2
                return address

    def parse_stores(self, response):
        store_address = self.parse_address(response)

    def parse_regions(self, response):
        regions = response.xpath('//div[@class="overviewRegions"]/a[@href]').extract()
        for region in regions:
            region = region.split('href="')[1].split('" id')[0]
            region = response.url + region
            yield scrapy.Request(region, callback = self.parse_region)
            
    def parse(self, response):
        countries = response.xpath('//div[@class="col-xs-12"]/table[@class="contenttable"]/tbody/tr/td/a[@href]').extract()
        for country in countries:
            country = country.split('href="')[1].split('" target')[0]
            yield scrapy.Request(country, callback = self.parse_regions)
